<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <title>easyLearning: 2D测试数据编辑</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <!-- 最新 Bootstrap 核心 CSS 文件 boostrap 3.0.3-->
    <link rel="stylesheet" href="css/lib/bootstrap.min.css">
    <link rel="stylesheet" href="css/lib/bootstrap-theme.min.css">
    <!-- 本地CSS文件 -->
    <link rel="stylesheet" href="css/mystyle.css">
</head>
<body>

<div class="container" id="mainform">

<h3> 2D 分类数据生成器 </h3>

<div class="btn-toolbar" role="toolbar">
  <div class="btn-group">
    <button type="button" class="btn btn-default" id="btnLabelTrue">True: 1</button>
    <button type="button" class="btn btn-default" id="btnLabelFalse">False: 0</button>
  </div>
  <div class="btn-group">
    <button type="button" class="btn btn-default" id="btnClear">清除</button>
    <button type="button" class="btn btn-default" id="btnDump">输出</button>
    <button type="button" class="btn btn-default" id="btnLoad">输入</button>
  </div>
</div>
<hr>
<div class="row">
  <div class="col-md-6">
    <div class="data_frame" id="dataFrame">

    </div>
  </div>

  <div class="col-md-6">
    <span>Samples JSON:</span>
    <textarea class="form-control" rows="10" style="{wdith:100%;}" id="samplesText"></textarea>
  </div>
</div>

</div>

<!-- jQuery文件。务必在bootstrap.min.js 之前引入 Jquery 1.10.2, bootstrap 3.0.3-->
<script src="js/lib/jquery.min.js"></script>
<script src="js/lib/bootstrap.min.js"></script>
<script src="js/lib/d3.v3.min.js"></script>

<!-- 主函数 -->
<script type="text/javascript">

var svg = d3.select("#dataFrame").append("svg")
    .attr("width", 512)
    .attr("height", 512);

var xScale = d3.scale.linear().domain([-1, 1]).range([0, 512]),
    yScale = d3.scale.linear().domain([1, -1]).range([0, 512]);

var label = 1;
var samples = {};
samples.t = 'C';
samples.o = 1;
samples.i = 2;
samples.d = [];

var onFrameClick = function(evt) {
    var rect = this.getBoundingClientRect();
    var x = evt.clientX - rect.left;
    var y = evt.clientY - rect.top;

    var xx = xScale.invert(x);
    var yy = yScale.invert(y);

    var circle = svg.append("circle")
            .attr("class", "dot")
            .attr("r", 3.5)
            .attr("cx", x)
            .attr("cy", y);
    if ( label === 0) {
      circle.style("fill", "red");
    } else {
      circle.style("fill", "lightgreen");
    }

    samples.d.push([label, xx, yy]);
};

// like main function in C
$(document).ready(function() {
  /* 绘制坐标 */
  var w = 512,
      h = 512,
      pad = 20,
      left_pad = 40;
  var xAxis = d3.svg.axis().scale(xScale).orient("bottom"),
      yAxis = d3.svg.axis().scale(yScale).orient("left");
  svg.append("g")
      .attr("class", "axis")
      .attr("transform", "translate(-1, 255)")
      .call(xAxis);
  svg.append("g")
      .attr("class", "axis")
      .attr("transform", "translate(255, -1)")
      .call(yAxis);

  svg.append("rect")
     .attr("x", w - 18)
     .attr("y", 20)
     .attr("width", 18)
     .attr("height", 18)
     .style('fill', 'red');
  svg.append("text")
     .attr("x", w - 72)
     .attr("y", 30)
     .text('False: 0');

  svg.append("rect")
     .attr("x", w - 18)
     .attr("y", 40)
     .attr("width", 18)
     .attr("height", 18)
     .style('fill', 'green');
  svg.append("text")
     .attr("x", w - 72)
     .attr("y", 50)
     .text('True: 1');

   document.getElementById("dataFrame").addEventListener('click', onFrameClick, false);
   $("#btnLabelFalse").click( function() {
      label = 0;
   });
   $("#btnLabelTrue").click( function() {
      label = 1;
   });

  $("#btnClear").click( function() {
      svg.selectAll("circle").remove();
      samples.d = [];

      $("#samplesText").val("");
  });

  $("#btnDump").click( function() {
      $("#samplesText").val( JSON.stringify(samples) );
  });

  $("#btnLoad").click( function() {
      var myObject = JSON.parse( $("#samplesText").val());

      if ( myObject.t === 'C' && myObject.o === 1 && myObject.i === 2 && myObject.d.length > 0) {
          svg.selectAll("circle").remove();
          samples.d = myObject.d;

          svg.selectAll("circle").data(samples.d).enter().append("circle")
                  .attr("class", "dot")
                  .attr("r", 3.5)
                  .attr("cx", function(d) {return xScale(d[1]);})
                  .attr("cy", function(d) {return yScale(d[2]);})
                  .style("fill", function(d) {
                    if (d[0] === 0) {
                      return 'red';
                    } else {
                      return 'lightgreen';
                    }
                  });
      } else if ( myObject.t === 'V' && myObject.o === 1 && myObject.i == 2 && myObject.d.length > 0) {
          for (i = 0; i < myObject.d.length; i++) {
              var x = xScale( myObject.d[i][1]);
              var y = yScale( myObject.d[i][2]);
              svg.append("circle")
                .attr("class", "dot")
                .attr("r", 1.0)
                .attr("cx", x)
                .attr("cy", y);
          }
      }


  });



});


</script>
</body>
</html>
